import { VerticalBox, ScrollView } from "std-widgets.slint";
import { CircleId } from "utils.slint";

export struct ScheduleItem {
    id: string,
    description: string,
    next_trigger: string,
    triggers: [string],
}

component TriggerCapsule inherits Rectangle {
    in property <string> text: "";

    height: 30px;
    border-radius: 15px;
    background: #e8f1ff;
    border-width: 1px;
    border-color: #c6dcff;

    HorizontalLayout {
        alignment: LayoutAlignment.center;
        Text {
            text: root.text;
            font-size: 13px;
            color: #1c1c1c;
            vertical-alignment: center;
        }
    }
}

component NextTriggerCapsule inherits Rectangle {
    in property <string> text: "";

    height: 30px;
    border-radius: 15px;
    background: #d9e9ff;
    border-width: 1px;
    border-color: #b3d3ff;

    HorizontalLayout {
        alignment: LayoutAlignment.center;
        padding: 10px;
        Text {
            text: root.text;
            font-size: 13px;
            color: #1c1c1c;
            vertical-alignment: center;
        }
    }
}

component CancelScheduleButton inherits Rectangle {
    callback clicked();

    width: 96px;
    height: 34px;
    border-radius: 17px;
    background: #ffe1e1;
    border-width: 1px;
    border-color: #ff9b9b;
    animate background { duration: 120ms; }

    touch := TouchArea {
        clicked => { root.clicked(); }
    }

    HorizontalLayout {
        alignment: LayoutAlignment.center;
        Text {
            text: "取消日程";
            font-size: 13px;
            color: #c62828;
            vertical-alignment: center;
        }
    }

    states [
        pressed when touch.pressed: {
            opacity: 0.85;
        }
        hover when touch.has-hover: {
            background: #ffd1d1;
        }
    ]
}

export component ScheduleView inherits Rectangle {
    in property <[ScheduleItem]> schedules: [];
    callback cancel(string);

    background: #f0f8ff;

    VerticalBox {
        padding: 18px;
        spacing: 12px;
        width: 100%;
        height: 100%;

        Text {
            text: "日程管理";
            font-size: 24px;
            horizontal-alignment: center;
            color: #1c1c1c;
        }

        ScrollView {
            viewport-width: self.width;
            viewport-height: content.preferred-height;
            content := VerticalBox {
                spacing: 14px;
                width: 100%;

                if (root.schedules.length == 0): Rectangle {
                    height: 120px;
                    border-radius: 24px;
                    background: #ffffff;
                    border-width: 1px;
                    border-color: #dbe6ff;
                    Text {
                        text: "暂无日程";
                        font-size: 16px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                        color: #6b6b6b;
                    }
                }

                for schedule in root.schedules: Rectangle {
                    background: #ffffff;
                    border-radius: 28px;
                    border-width: 1px;
                    border-color: #dbe6ff;
                    clip: true;
                    drop-shadow-color: #d3e5ff;
                    drop-shadow-offset-x: 0px;
                    drop-shadow-offset-y: 2px;
                    drop-shadow-blur: 8px;

                    VerticalBox {
                        width: 100%;
                        padding: 14px;
                        spacing: 10px;

                        HorizontalLayout {
                            width: parent.width;

                            CircleId { }
                            VerticalLayout { width: 2%; }
                            VerticalLayout {
                                width: 62%;
                                Text {
                                    text: schedule.id;
                                    font-size: 16px;
                                    color: #3f4c67;
                                    wrap: word-wrap;
                                    overflow: elide;
                                    vertical-alignment: center;
                                }
                            }
                            HorizontalLayout {
                                width: 24%;
                                alignment: end;
                                CancelScheduleButton { clicked => { root.cancel(schedule.id); } }
                            }
                        }

                        Text {
                            text: schedule.description;
                            font-size: 16px;
                            color: #1c1c1c;
                            wrap: word-wrap;
                            overflow: elide;
                        }

                        HorizontalLayout {
                            spacing: 8px;
                            alignment: LayoutAlignment.start;
                            Text {
                                text: "下一次触发";
                                font-size: 16px;
                                color: #3f4c67;
                                vertical-alignment: center;
                            }
                            NextTriggerCapsule { text: schedule.next_trigger; }
                        }

                        Text {
                            text: "触发时间";
                            font-size: 16px;
                            color: #3f4c67;
                        }

                        VerticalBox {
                            spacing: 4px;
                            for trigger in schedule.triggers: HorizontalLayout {
                                TriggerCapsule { text: trigger; }
                            }
                        }
                    }
                }
            }
        }
    }
}
