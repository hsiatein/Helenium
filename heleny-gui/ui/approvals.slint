import { VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";

export struct ConsentRequestionSlint {
    request_id: string,
    task_id: string,
    task_description: string,
    reason: string,
    descripion: string,
}

component ActionButton inherits Rectangle {
    in property <string> label: "";
    in property <brush> btn-color: #7fb5ff;
    callback clicked();

    height: 36px;
    width: 120px;
    background: btn-color;
    border-radius: 18px;
    animate background { duration: 150ms; }

    touch := TouchArea {
        clicked => { root.clicked(); }
    }

    Text {
        text: root.label;
        font-size: 14px;
        color: #1c1c1c;
        width: 100%;
        height: 100%;
        horizontal-alignment: center;
        vertical-alignment: center;
    }

    states [
        pressed when touch.pressed: {
            opacity: 0.85;
        }
        hover when touch.has-hover: {
            background: #b2d4ff;
        }
    ]
}

export component ApprovalsView inherits Rectangle {
    in property <[ConsentRequestionSlint]> requests: [];
    callback approve(string);
    callback reject(string);

    background: #f0f8ff;

    VerticalBox {
        padding: 18px;
        spacing: 12px;
        width: 100%;
        height: 100%;

        Text {
            text: "审批请求";
            font-size: 24px;
            horizontal-alignment: center;
            color: #1c1c1c;
        }

        ScrollView {
            viewport-width: self.width;
            viewport-height: content.preferred-height;
            content := VerticalBox {
                spacing: 14px;
                width: 100%;
                if (root.requests.length == 0): Rectangle {
                    height: 120px;
                    border-radius: 24px;
                    background: #ffffff;
                    Text {
                        text: "暂无审批请求";
                        font-size: 16px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                        color: #6b6b6b;
                    }
                }
                for req in root.requests : Rectangle {
                    background: #ffffff;
                    border-radius: 24px;
                    border-width: 1px;
                    border-color: #dbe6ff;
                    clip: true;

                    VerticalBox {
                        padding: 16px;
                        spacing: 8px;
                        width: 100%;

                        Text {
                            text: "任务ID: " + req.task_id;
                            font-size: 16px;
                            color: #1c1c1c;
                            wrap: word-wrap;
                        }
                        Text {
                            text: "任务描述: " + req.task_description;
                            font-size: 16px;
                            color: #1c1c1c;
                            wrap: word-wrap;
                        }
                        Text {
                            text: "原因: " + req.reason;
                            font-size: 16px;
                            color: #1c1c1c;
                            wrap: word-wrap;
                        }
                        Text {
                            text: "请求描述: " + req.descripion;
                            font-size: 16px;
                            color: #1c1c1c;
                            wrap: word-wrap;
                        }

                        HorizontalBox {
                            spacing: 12px;
                            alignment: LayoutAlignment.end;
                            ActionButton {
                                label: "同意";
                                btn-color: #7fb5ff;
                                clicked => { root.approve(req.request_id); }
                            }
                            ActionButton {
                                label: "不同意";
                                btn-color: #f2a6a6;
                                clicked => { root.reject(req.request_id); }
                            }
                        }
                    }
                }
            }
        }
    }
}
